<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple DApp</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js" type="application/javascript"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
        .gas-info { background: #f0f8ff; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Simple DApp</h1>
    
    <button id="connectButton">Connect Wallet</button>
    <button id="mintButton" disabled>Mint Token</button>
    
    <div id="gasEstimate" class="gas-info" style="display: none;">
        <strong>Gas Estimate:</strong> <span id="gasInfo">Calculating...</span>
    </div>
    
    <div id="status"></div>

    <script>
        let provider;
        let signer;
        let contract;

        // Contract address - DEĞİŞTİRME
        const contractAddress = "0x3efda406e6a89664a0ffca628e7fcd80b274f9ac";
        
        // BASİT ABI - Sadece ihtiyacımız olan fonksiyonlar
        const contractABI = [
            "function mint(uint256 amount) public",
            "function balanceOf(address account) public view returns (uint256)"
        ];

        document.getElementById('connectButton').onclick = connectWallet;
        document.getElementById('mintButton').onclick = mintToken;

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = provider.getSigner();
                    contract = new ethers.Contract(contractAddress, contractABI, signer);
                    
                    const address = await signer.getAddress();
                    document.getElementById('status').innerHTML = `<p class="success">Connected: ${address.substring(0, 6)}...${address.substring(38)}</p>`;
                    document.getElementById('mintButton').disabled = false;
                    document.getElementById('gasEstimate').style.display = 'block';
                    
                    // Gas estimate hesapla
                    estimateGas();
                    
                } catch (error) {
                    document.getElementById('status').innerHTML = `<p class="error">Connection failed: ${error.message}</p>`;
                }
            } else {
                document.getElementById('status').innerHTML = '<p class="error">Please install MetaMask!</p>';
            }
        }

        async function estimateGas() {
            if (!contract) return;
            
            try {
                // Gas estimate al
                const gasLimit = await contract.estimateGas.mint(1);
                const gasPrice = await provider.getGasPrice();
                const gasCost = gasLimit.mul(gasPrice);
                const gasCostETH = ethers.utils.formatEther(gasCost);
                
                document.getElementById('gasInfo').textContent = 
                    `~${parseFloat(gasCostETH).toFixed(6)} ETH (current network gas price)`;
                    
            } catch (error) {
                document.getElementById('gasInfo').textContent = 'Unable to estimate gas';
            }
        }

        async function mintToken() {
            if (!contract) {
                alert("Please connect wallet first");
                return;
            }

            try {
                document.getElementById('status').innerHTML = '<p>Minting tokens...</p>';
                document.getElementById('mintButton').disabled = true;

                // Mint işlemi - 1 token mint et
                // Gas price otomatik olarak güncel network değerini alacak
                const tx = await contract.mint(1);
                
                document.getElementById('status').innerHTML = '<p>Transaction sent, waiting for confirmation...</p>';
                
                await tx.wait();
                
                document.getElementById('status').innerHTML = '<p class="success">Tokens minted successfully!</p>';
                document.getElementById('mintButton').disabled = false;
                
                // Gas estimate'ı güncelle
                estimateGas();
                
            } catch (error) {
                document.getElementById('status').innerHTML = `<p class="error">Minting failed: ${error.message}</p>`;
                document.getElementById('mintButton').disabled = false;
            }
        }
    </script>
</body>
</html>
